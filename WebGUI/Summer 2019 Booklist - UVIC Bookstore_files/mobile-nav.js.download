$(document).ready(function() {

    //Random toggles
    $("h1.hide-above-550").click(function () {
        $(this).next().toggle();
    });

    //Mobile-Nav seccondary-navs
    $('.dropdown-toggle').click(function(event){
        event.preventDefault();
        $(this).toggleClass('open');
        $(this).next('.dropdown-menu').toggleClass('menu-open')
    });

    //Closes the side-nav
    function closeSide(){
        $('.mobile-nav').sidebar('hide');
    }

    //Open Navigation
    function openSide(){
        $('.dropdown-menu').removeClass('menu-open');
        $('.dropdown-toggle').removeClass('open');

        $('.dropdown.active-parent').find('.dropdown-menu').addClass('menu-open');
        $('.dropdown.active-parent').find('.dropdown-toggle').addClass('open');

        $('.mobile-nav')
            .sidebar('setting', 'mobileTransition', 'overlay')
            .sidebar('setting', 'transition', 'overlay')
            .sidebar('setting', 'closable', false)
            .sidebar('setting', 'duration', 200)

            .sidebar('show')

    }


    //Function that calls close nav from within nav
    $('.close').click(function(){
        closeSide();
    });

    //Prevents propagation on click outside of nav
    $('.pusher').click(function (event) {
        if($('.mobile-nav').hasClass('animating')){
            event.preventDefault();//Don't follow through click
        }
    });

    $('.pusher').on('mouseup/touchend', function (event) {
        if($('.mobile-nav').hasClass('visible')){
            event.preventDefault();//Don't follow through click
        }
    });

    //Function that calls open nav
    $("#shownav").mouseup(function(){
        openSide();
    });

    //Slides that open and close nav's
    document.addEventListener('touchstart', handleTouchStart, false);
    document.addEventListener('touchmove', handleTouchMove, false);
    document.addEventListener('touchend', handleTouchEnd, false);

    var xDown, yDown = null;

    //On touch start
    function handleTouchStart(event)
    {
        xDown = event.touches[0].clientX;
        yDown = event.touches[0].clientY;
    }

    //Duration of touch
    function handleTouchMove(event)
    {
        if (xDown === null || yDown === null) {
            return;
        }

        var xDiff = xDown - event.touches[0].clientX;
        var yDiff = yDown - event.touches[0].clientY;

        if (xDown < 15) { //If swipe started at edge
            if (Math.abs(xDiff) > Math.abs(yDiff/4)) { //If swipe went horizontal
                if (xDiff < 100) { //If swipe went horizontal right
                    openSide();
                }
            }
        }

        if (Math.abs(xDiff) > Math.abs(yDiff/4)) { //If swipe went horizontal
            if (xDiff > 100) { //If swipe went horizontal left
                closeSide();
            }
        }
    }

    //Touch ends
    function handleTouchEnd(event)
    {
        xDown, yDown = null;
    }
});